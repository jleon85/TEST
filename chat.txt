failed"};switch(this.roomId=i.roomInfo.roomId,this.cardId=i.roomInfo.cardId,this.roomNum=i.roomInfo.roomNum,this.roomSitNum=i.roomInfo.roomSitNum,this.bankrollAmount=parseFloat(i.bankrollAmountStr),this.bankrollCurrency=i.bankrollCurrency,this.hasPassword=i.roomInfo.hasPassword,this.table.tableLabel.string=this.roomNum.toString(),this.table.fairCode.string=this.cardId.toString(),this.serverDelay=i.timestemp-Date.now(),this.table.leaveCards=i.leaveCards,this.expireTime=this.timeToLocal(i.statusExpireTimeInMills),1===this.roomSitNum?this.playerList[1].node.active=!0:this.playerList.forEach(function(e){return e.node.active=!0}),this.bankerInfo=p.default.find(i.players,function(e){return 0===e.player.position}).player,a=i.players.filter(function(e){return 0!==e.player.position}),i.status){case 20:this.state.state=f.READY;break;case 50:this.state.state=f.ASK;break;case 70:this.state.state=f.BEGIN}return S.Config.currencyDict?[3,3]:[4,y.default.instance.reInit()];case 2:c.sent(),c.label=3;case 3:return this.currencyInfo=i.currencies.reduce(function(e,t){t&&t.currencyName?S.Config.currencyDict[t.currencyName]||y.sendGTagError("no currency: "+t.currencyName+", l="+Object.keys(S.Config.currencyDict).length,!0):y.sendGTagError("currencies error:"+(t?"cn null":"item null"),!0);var n=S.Config.currencyDict[t.currencyName].chipScale;return e[t.currencyName]={chipScale:n,maxAmount:new d.default(t.maxAmount).div(n),minAmount:new d.default(t.minAmount).div(n),currencyName:t.currencyName,aliasCurrencyName:t.currencyName,precision:S.Config.currencyDict[t.currencyName].precision,usdRate:t.usdRate},e},{}),S.Config.currencyRoom=this.currencyInfo,this.table.init(),a.forEach(function(e){h.playerSitDown(e.player)}),i.cardsGroup.sort(function(e,t){return e.position==t.position?e.status!=t.status?4==e.status?1:4==t.status?-1:t.status-e.status:0:e.position-t.position}),i.cardsGroup.forEach(function(e){if(0===e.position)h.banker.addGroup(e);else{var t=h.getPlayer(e.position);if(t.chipName=e.currencyName,t.handleInitData(e),e.userId==y.default.User.userId)if(S.default.currency=e.currencyName,h.state.state==f.ASK){var n=t.chipGroup.getItemById(e.betId);n&&(t.chips=n)}else h.state.state==f.READY&&h.loginPlayer&&(h.loginPlayer.state.state=b.PlayerState.BETED,a.forEach(function(e){if(e.player.userId!=y.default.User.userId);else if(e.pairAmount>0){var t=S.Config.currencyDict[e.currencyName].chipScale;h.loginPlayer.handlePair(new d.default(e.pairAmount).div(t))}}))}}),S.default.emit("currency"),this.state.is(f.ASK)&&a.forEach(function(e){var t=h.getPlayer(e.player.position);if(e.askHasChoosed){if(e.insuranceAmount>0){var n=S.Config.currencyDict[e.currencyName].chipScale;t.onInsurance({betId:0,currencyName:e.currencyName,amount:new d.default(e.insuranceAmount).div(n)})}}else t.onAsk(h.expireTime)}),this.loginPlayer||(s=!0,"number"==typeof n&&(n<0?(u=a.map(function(e){return e.player.position}),this.roomSitNum?0===u.length&&this.table.handleSitDown(2):(l=p.default.difference([1,2,3],u)).length>0&&(n=p.default.sample(l),s=!1,this.table.handleSitDown(n))):(s=!1,this.table.handleSitDown(n))),s&&y.default.Toast.show("SELECT YOUR SEAT!",2e3)),[2]}})})},t.prototype.onPong=function(e){},t.prototype.onRoomDestroying=function(){},t.prototype.onRoomDestroy=function(e){return u(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return e!==this.roomId?[3,5]:y.default.User.userId!==this.bankerInfo.userId?[3,2]:(y.default.User.syncAmount(),[4,this.table.handleOpenSettle()]);case 1:return t.sent(),[3,4];case 2:return[4,y.default.instance.alert("SORRY, THE ROOM IS CLOSED!")];case 3:t.sent(),t.label=4;case 4:y.default.instance.sceneReplace("TableSelect"),t.label=5;case 5:return[2]}})})},t.prototype.onGameWait=function(e){O.stateMachine.to(O.WebSocketState.WAIT,this.getTag("w")),this.bankrollAmount=e,this.table.refreshBankroll()},t.prototype.onGameReady=function(e){var t=this;O.stateMachine.to(O.WebSocketState.BET,this.getTag("r")),this.addQueue(function(){t.state.state=f.READY,t.expireTime=t.timeToLocal(e),t.banker.removeCardGroup(),t.sitPlayers.forEach(function(e){return e.onReady(t.expireTime)})})},t.prototype.onGameBegin=function(e){var t=this,r=e.leaveCards,o=e.cardsGroup,i=e.cardId;O.stateMachine.to(O.WebSocketState.DEAL,this.getTag("gb")),this.addQueue(function(){(t.table.betActions.hide(),t.cardId=i,t.table.fairCode.string=t.cardId.toString(),t.table.leaveCards=r+=2*o.length,t.state.state=f.BEGIN,o.forEach(function(e){0===e.position?t.banker.onBegin():t.getPlayer(e.position).onBegin(e)}),t.loginPlayer)&&(p.default.find(o,function(e){return e.userId===y.default.User.userId})||(t.table.cancelBet(b.PlayerState.WAIT),y.default.Toast.show("WAIT FOR NEXT ROUND!",2e3)))}),p.default.times(2,function(e){o.forEach(function(r){t.addQueue(function(){var o,i=r.position;o=0===r.position?t.banker.cardGroup:t.getPlayer(i).cardGroup,t.table.leaveCards-=1,o.addCard(r.cards[e],n.instance.dealPosition),e>0&&i>0&&t.getPlayer(i).onDealEnd()},.3)})})},t.prototype.onGameAsk=function(e){var t=this;O.stateMachine.to(O.WebSocketState.ASK,this.getTag("a")),this.addQueue(function(){t.betPlayers.forEach(function(n){return n.onAsk(t.timeToLocal(e))})})},t.prototype.onPlayerAnswerd=function(e){var t=this;O.stateMachine.is(O.WebSocketState.ASK,this.getTag("c")),this.addQueue(function(){t.betPlayers.forEach(function(t){t.playerData.userId===e.userId&&t.onAnswerd()})})},t.prototype.onGamePlay=function(){var e=this;this.addQueue(function(){e.betPlayers.forEach(function(e){return e.onPlay()})})},t.prototype.onGameEnd=function(){var e=this;O.stateMachine.to(O.WebSocketState.SETTLE,this.getTag("st"));var t=3.3,n=[];this.sitPlayers.forEach(function(e){e.chipGroup.getListByType(w.ChipsType.BET).filter(function(e){return!e.isSettle}).forEach(function(e,t){n[t]||(n[t]=[]),n[t].push(e)})});for(var r=0;r<n.length;r++)t+=.5;this.addQueue(function(){return u(e,void 0,void 0,function(){var e,t,r,o;return c(this,function(i){switch(i.label){case 0:return i.trys.push([0,7,,8]),this.state.state=f.STOP,this.banker.onSettle(),[4,g.delay(1e3)];case 1:i.sent(),e=0,i.label=2;case 2:if(!(e<n.length))return[3,5];for(t=n[e],r=0;r<t.length;r++)(o=t[r]).player.onSettle(o.betId).catch(console.log);return e<n.length-1?[4,g.delay(500)]:[3,4];case 3:i.sent(),i.label=4;case 4:return e++,[3,2];case 5:return[4,g.delay(2e3)];case 6:return i.sent(),this.banker.removeCardGroup(),[3,8];case 7:return i.sent(),[2,Promise.resolve()];case 8:return[2]}})})},t)},t.prototype.onInsuranceSettle=function(e){var t=this;O.stateMachine.is(O.WebSocketState.ASK,this.getTag("i")),this.addQueue(function(){t.banker.onInsuranceSettle(),t.scheduleOnce(function(){return t.betPlayers.forEach(function(t){return t.onInsuranceSettle(e)})},1)},1.2)},t.prototype.onShuffleCards=function(e){var t=this;O.stateMachine.to(O.WebSocketState.SHUFFLE,this.getTag("sf")),this.addQueue(function(){t.table.handleShuffleCard()},1.5)},t.prototype.onPlayerSitDown=function(e){var t=this;this.addQueue(function(){t.playerSitDown(e)})},t.prototype.playerSitDown=function(e){if(0!==e.position){var t=this.getPlayer(e.position);if(t.onSitDown(e),e.userId===y.default.User.userId&&(t.chipName=S.default.currency,this.loginPlayer=t,this.loginPlayer.state.on("change",this.onPlayStateChange),this.state.state>=f.BEGIN&&y.default.Toast.show("WAIT FOR NEXT ROUND!",2e3),this.unSitPlayers.forEach(function(e){return e.hideSit()})),this.state.is(f.READY))t.chipGroup.getItemByType(w.ChipsType.BET)||t.onReady(this.expireTime)}else this.banker.init()},t.prototype.onPlayerStandUp=function(e){var t=this,n=e.userId,r=e.position;this.addQueue(function(){t.getPlayer(r).onSitUp(),n===y.default.User.userId&&(t.loginPlayer&&(t.loginPlayer.state.off("change",t.onPlayStateChange),t.loginPlayer=null),t.unSitPlayers.forEach(function(e){return e.showSit()}))})},t.prototype.onPlayerBet=function(e){var t=this;O.stateMachine.is(O.WebSocketState.BET,this.getTag("b")),this.addQueue(function(){var n=t.getPlayer(e.position);n.chipName=e.currencyName,n.onBet(T(e)),n==t.loginPlayer&&(t.table.confirmBetLayer.active=!1)})},t.prototype.onPlayerSurrender=function(e){var t=this;O.stateMachine.to(O.WebSocketState.SURRENDER,this.getTag("s")),this.addQueue(function(){t.getPlayer(e.position).onSurrender()})},t.prototype.onPlayerInsurance=function(e){var t=this;O.stateMachine.is(O.WebSocketState.ASK,this.getTag("ai")),this.addQueue(function(){t.getPlayer(e.position).onInsurance(T(e))},.3)},t.prototype.onPlayerEven=function(e){var t=this;O.stateMachine.is(O.WebSocketState.ASK,this.getTag("e")),this.addQueue(function(){t.getPlayer(e.position).onEven({betId:e.betId,currencyName:e.currencyName,amount:new d.default(e.betAmount).div(S.default.currencyDict[e.currencyName].chipScale)})})},t.prototype.onPlayerBegin=function(e){var t=this;0===e.position?O.stateMachine.to(O.WebSocketState.BANKER_PLAY,this.getTag("bB")):O.stateMachine.to(O.WebSocketState.PLAY,this.getTag("pB")),this.addQueue(function(){e.expireTime=t.timeToLocal(e.expireTime),0===e.position?t.banker.onDeal(e.cards[1]):t.getPlayer(e.position).onDeal(e)},.3)},t.prototype.onPlayerPairSettle=function(e){var t=this,n=e.odds;this.addQueue(function(){Object.keys(n).forEach(function(e){var r=parseInt(e);t.getPlayer(r).onPairSettle(n[e]/100)})})},t.prototype.onPlayerHit=function(e){var t=this,n=e.position,r=e.betId,o=e.newCard;0===n?O.stateMachine.to(O.WebSocketState.BANKER_HIT,this.getTag("bH")):O.stateMachine.to(O.WebSocketState.HIT,this.getTag("pH")),this.addQueue(function(){t.table.leaveCards-=1,0===n?t.banker.onHit(o):t.getPlayer(n).onHit(r,o)},.5)},t.prototype.onPlayerDouble=function(e){var t=this,n=e.cardsInfo;O.stateMachine.to(O.WebSocketState.DOUBLE,this.getTag("d")),this.addQueue(function(){t.table.leaveCards-=1,t.getPlayer(n.position).onDouble(n.betId,n.newCard)},.3)},t.prototype.onPlayerSplit=function(e){var t=this,n=e.cardsInfo1,r=e.cardsInfo2;O.stateMachine.to(O.WebSocketState.SPLIT,this.getTag("psp")),this.addQueue(function(){t.table.leaveCards-=2;var e=n.position;t.getPlayer(e).onSplit([n,r]),t.onPlayerBegin(n)},1.2)},t.prototype.onPlayerStand=function(e){var t=this;0===e.position?O.stateMachine.to(O.WebSocketState.BANKER_STAND,this.getTag("bS")):O.stateMachine.to(O.WebSocketState.STAND,this.getTag("pS")),this.addQueue(function(){0===e.position?t.banker.onStand(e):t.getPlayer(e.position).onStand(e.betId)},.3)},t.prototype.addQueue=function(e,t){var n=this;void 0===t&&(t=0),this.msgQueue.add(function(){return new Promise(function(r,o){n.isValid||o("game is not valid");try{e()}catch(e){throw e}finally{n.scheduleOnce(r,t)}})})},t.prototype.timeToLocal=function(e){return e-this.serverDelay},t.prototype.getPlayer=function(e){return this.playerList[e-1]},Object.defineProperty(t.prototype,"sitPlayers",{get:function(){return this.playerList.filter(function(e){return e.state.not(b.PlayerState.LEAVE)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unSitPlayers",{get:function(){return this.playerList.filter(function(e){return e.state.is(b.PlayerState.LEAVE)})},enumerable:!1